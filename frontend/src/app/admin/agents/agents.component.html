<div class="p-6 w-full bg-[#e6f3ff] min-h-screen space-y-8">

  <!-- Back Button -->
  <button (click)="admin()" 
    class="bg-gray-200 text-gray-700 px-4 py-2 rounded-md hover:bg-gray-300 transition font-semibold shadow-sm">
    ‚Üê Back to Admin Dashboard
  </button>

  <!-- Title -->
  <h2 class="text-3xl font-bold text-gray-800 text-center">Agent Management</h2>

  <!-- Create Agent Form -->
  <div class="bg-white shadow-lg rounded-2xl p-6 border border-gray-200 space-y-4 w-full">
    <h3 class="text-xl font-semibold text-gray-700 mb-4">Create New Agent</h3>
    <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
      <input type="text" placeholder="Name" [(ngModel)]="name" 
        class="border rounded-md p-3 w-full focus:outline-none focus:ring-2 focus:ring-blue-400" />
      <input type="email" placeholder="Email" [(ngModel)]="email" 
        class="border rounded-md p-3 w-full focus:outline-none focus:ring-2 focus:ring-blue-400" />
      <input type="password" placeholder="Password" [(ngModel)]="password" 
        class="border rounded-md p-3 w-full focus:outline-none focus:ring-2 focus:ring-blue-400" />
    </div>
    <button (click)="createAgent()" 
      class="bg-blue-600 text-white px-6 py-2 rounded-md hover:bg-blue-700 transition font-semibold shadow">
      Create Agent
    </button>
  </div>

  <!-- List of Agents -->
  <div class="bg-white shadow-lg rounded-2xl p-6 border border-gray-200 w-full">
    <h3 class="text-xl font-semibold text-gray-700 mb-4">All Agents</h3>
    <div class="overflow-x-auto">
      <table class="w-full divide-y divide-gray-200">
        <thead class="bg-gray-100">
          <tr>
            <th class="px-6 py-3 text-left text-sm font-medium text-gray-600">Name</th>
            <th class="px-6 py-3 text-left text-sm font-medium text-gray-600">Email</th>
            <th class="px-6 py-3 text-left text-sm font-medium text-gray-600">Policies</th>
            <th class="px-6 py-3 text-left text-sm font-medium text-gray-600">Assign Policy</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-gray-200">
          <tr *ngFor="let agent of agents" class="hover:bg-gray-50 transition">
            <td class="px-6 py-4 font-medium text-gray-700">{{ agent.name }}</td>
            <td class="px-6 py-4 text-gray-600">{{ agent.email }}</td>
            <td class="px-6 py-4">
              <button (click)="getAgentPolicies(agent._id)" 
                class="bg-green-500 text-white px-3 py-1 rounded-md hover:bg-green-600 transition font-semibold shadow">
                View Policies
              </button>
            </td>
            <td class="px-6 py-4 flex items-center space-x-2">
              <select [(ngModel)]="selectedPolicyMap[agent._id]" 
                class="border rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-blue-400">
                <option value="">Select User Policy</option>
                <option *ngFor="let policy of unassignedPolicies" [value]="policy._id">{{ policy._id }}</option>
              </select>
              <button (click)="assignAgent(agent._id)" 
                class="bg-blue-600 text-white px-3 py-1 rounded-md hover:bg-blue-700 transition font-semibold shadow">
                Assign
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Selected Agent Policies -->
  <div *ngIf="selectedAgentPolicies.length > 0" 
    class="bg-white shadow-lg rounded-2xl p-6 border border-gray-200 w-full">
    <h3 class="text-xl font-semibold text-gray-700 mb-4">Selected Agent Policies</h3>
    <ul class="divide-y divide-gray-100">
      <li *ngFor="let policy of selectedAgentPolicies" 
        class="py-2 flex flex-col sm:flex-row sm:justify-between sm:items-center">
        <div class="text-gray-700">
          <span class="font-medium text-gray-800">Policy Code:</span> {{ policy.policyProductId?.code }}
        </div>
        <div class="text-gray-700">
          <span class="font-medium text-gray-800">Customer:</span> {{ policy.userId?.name }}
        </div>
        <div class="text-gray-700">
          <span class="font-medium text-gray-800">Status:</span> {{ policy.status }}
        </div>
      </li>
    </ul>
  </div>

</div>
